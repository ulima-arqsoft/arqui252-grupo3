> [7. Estructura Inicial de C√≥digo](../7.md) ‚Ä∫ [7.2. Mapeo Aplicaciones vs M√≥dulos](7.2.md)

# 7.2. Mapeo Aplicaciones vs M√≥dulos

## Mapeo entre Aplicaciones y M√≥dulos Funcionales

Este documento establece la relaci√≥n entre las aplicaciones t√©cnicas (frontend, backend, base de datos) y los m√≥dulos funcionales del sistema InnovaLogix Retail ERP.

### Tabla de Mapeo General

| M√≥dulo Funcional | Aplicaci√≥n Frontend | Aplicaci√≥n Backend | Base de Datos | Servicios Externos |
|-----------------|---------------------|--------------------|--------------|--------------------|
| **Ventas R√°pidas** | ‚úì | ‚úì | ‚úì | - |
| **Inventario** | ‚úì | ‚úì | ‚úì | - |
| **Compras** | ‚úì | ‚úì | ‚úì | - |
| **Reportes** | ‚úì | ‚úì | ‚úì | - |
| **CRM** | ‚úì | ‚úì | ‚úì | EmailJS |
| **Autenticaci√≥n** | ‚úì | ‚úì | ‚úì | - |

---

### M√≥dulo 01: Ventas R√°pidas (POS Web)

**Frontend (React):**
- **Rutas:**
  - `/pos` - Interfaz principal del punto de venta
  - `/sales` - Listado de ventas realizadas
  - `/sales/:id` - Detalle de venta espec√≠fica
  
- **Componentes:**
  - `POSInterface.jsx` - Interfaz principal con b√∫squeda y carrito
  - `ProductSearch.jsx` - Buscador de productos
  - `ShoppingCart.jsx` - Carrito de compra actual
  - `PaymentModal.jsx` - Modal para procesar pago
  - `ReceiptViewer.jsx` - Visualizador de comprobantes
  - `SalesList.jsx` - Lista de ventas con filtros
  
- **Servicios:**
  - `salesService.js` - Llamadas API para ventas
  - `offlineQueue.js` - Cola de sincronizaci√≥n offline

**Backend (Node.js/Express):**
- **M√≥dulo:** `src/modules/sales/`
- **Controllers:**
  - `SalesController.js` - Endpoints de ventas
  - `ReceiptController.js` - Generaci√≥n de comprobantes
  
- **Services:**
  - `SalesService.js` - L√≥gica de negocio de ventas
  - `ReceiptService.js` - Generaci√≥n de PDFs
  - `PaymentService.js` - Procesamiento de pagos
  - `DiscountService.js` - C√°lculo de descuentos y combos
  
- **Routes:**
  - `POST /api/sales` - Registrar nueva venta
  - `GET /api/sales` - Listar ventas
  - `GET /api/sales/:id` - Obtener detalle de venta
  - `GET /api/sales/:id/receipt` - Generar comprobante PDF

**Base de Datos (PostgreSQL):**
- **Tablas:**
  - `ventas` - Cabecera de ventas
  - `detalle_venta` - L√≠neas de productos vendidos
  - `comprobantes` - Informaci√≥n de boletas/facturas
  - `pagos` - Desglose de m√©todos de pago

**Eventos Emitidos:**
- `VentaConfirmada` ‚Üí Inventario (actualizaci√≥n de stock)

---

### M√≥dulo 02: Inventario

**Frontend (React):**
- **Rutas:**
  - `/inventory` - Dashboard de inventario
  - `/inventory/products` - Cat√°logo de productos
  - `/inventory/stock` - Control de stock por ubicaci√≥n
  - `/inventory/kardex` - Historial de movimientos
  - `/inventory/alerts` - Alertas de stock m√≠nimo
  
- **Componentes:**
  - `ProductCatalog.jsx` - Lista de productos con filtros
  - `ProductForm.jsx` - Formulario de producto/variante
  - `StockControl.jsx` - Ajuste de stock por ubicaci√≥n
  - `KardexReport.jsx` - Reporte kardex con filtros
  - `AlertsList.jsx` - Alertas de stock bajo
  - `PriceSeasonForm.jsx` - Configuraci√≥n de precios por temporada
  
- **Servicios:**
  - `inventoryService.js` - Operaciones de inventario
  - `catalogService.js` - Gesti√≥n de cat√°logo
  - `stockService.js` - Control de stock

**Backend (Node.js/Express):**
- **M√≥dulo:** `src/modules/inventory/`
- **Controllers:**
  - `CatalogController.js` - Productos y variantes
  - `StockController.js` - Control de stock
  - `KardexController.js` - Movimientos hist√≥ricos
  
- **Services:**
  - `CatalogService.js` - Gesti√≥n de productos
  - `StockService.js` - Operaciones de stock
  - `KardexService.js` - Registro de movimientos
  - `AlertService.js` - Generaci√≥n de alertas
  - `PriceService.js` - Precios por temporada
  
- **Routes:**
  - `GET /api/inventory/products` - Listar productos
  - `POST /api/inventory/products` - Crear producto
  - `PUT /api/inventory/products/:id` - Actualizar producto
  - `GET /api/inventory/stock` - Consultar stock
  - `POST /api/inventory/stock/adjust` - Ajustar stock
  - `GET /api/inventory/kardex` - Obtener kardex

**Base de Datos (PostgreSQL):**
- **Tablas:**
  - `productos` - Informaci√≥n de productos
  - `variantes` - Variantes (talla, color, etc.)
  - `stock` - Stock por variante y ubicaci√≥n
  - `ubicaciones` - Ubicaciones de almac√©n
  - `kardex` - Historial de movimientos
  - `precios_temporada` - Precios variables por temporada

**Eventos Escuchados:**
- `VentaConfirmada` ‚Üí Actualiza stock (salida)
- `CompraConfirmada` ‚Üí Actualiza stock (entrada)

---

### M√≥dulo 03: Compras

**Frontend (React):**
- **Rutas:**
  - `/purchases` - Dashboard de compras
  - `/purchases/suppliers` - Gesti√≥n de proveedores
  - `/purchases/orders` - √ìrdenes de compra
  - `/purchases/orders/new` - Nueva orden de compra
  
- **Componentes:**
  - `SuppliersList.jsx` - Lista de proveedores
  - `SupplierForm.jsx` - Formulario de proveedor
  - `PurchaseOrderList.jsx` - Lista de √≥rdenes de compra
  - `PurchaseOrderForm.jsx` - Formulario de orden
  - `OrderApproval.jsx` - Flujo de aprobaci√≥n
  - `PriceHistoryChart.jsx` - Gr√°fico de precios hist√≥ricos
  
- **Servicios:**
  - `purchaseService.js` - Operaciones de compras
  - `supplierService.js` - Gesti√≥n de proveedores

**Backend (Node.js/Express):**
- **M√≥dulo:** `src/modules/purchases/`
- **Controllers:**
  - `SuppliersController.js` - CRUD de proveedores
  - `OrdersController.js` - √ìrdenes de compra
  
- **Services:**
  - `SuppliersService.js` - L√≥gica de proveedores
  - `OrdersService.js` - Gesti√≥n de √≥rdenes
  - `ApprovalService.js` - Flujo de aprobaci√≥n
  - `PriceHistoryService.js` - Historial de precios
  
- **Routes:**
  - `GET /api/purchases/suppliers` - Listar proveedores
  - `POST /api/purchases/suppliers` - Crear proveedor
  - `GET /api/purchases/orders` - Listar √≥rdenes
  - `POST /api/purchases/orders` - Crear orden
  - `PUT /api/purchases/orders/:id/confirm` - Confirmar orden

**Base de Datos (PostgreSQL):**
- **Tablas:**
  - `proveedores` - Datos de proveedores
  - `compras` - Cabecera de √≥rdenes de compra
  - `detalle_compra` - L√≠neas de productos comprados
  - `historial_precios` - Precios hist√≥ricos por proveedor

**Eventos Emitidos:**
- `CompraConfirmada` ‚Üí Inventario (entrada de stock)

---

### M√≥dulo 04: Reportes

**Frontend (React):**
- **Rutas:**
  - `/reports` - Dashboard de reportes
  - `/reports/sales` - Reporte de ventas
  - `/reports/purchases` - Reporte de compras
  - `/reports/profitability` - An√°lisis de rentabilidad
  - `/reports/custom` - Reportes personalizados
  
- **Componentes:**
  - `ReportDashboard.jsx` - Dashboard con m√©tricas
  - `SalesReport.jsx` - Reporte de ventas con filtros
  - `PurchasesReport.jsx` - Reporte de compras
  - `ProfitabilityChart.jsx` - Gr√°ficos de rentabilidad
  - `ExportButtons.jsx` - Botones de exportaci√≥n PDF/Excel
  - `DateRangeFilter.jsx` - Filtro de rango de fechas
  
- **Servicios:**
  - `reportService.js` - Obtenci√≥n de reportes
  - `exportService.js` - Exportaci√≥n de archivos

**Backend (Node.js/Express):**
- **M√≥dulo:** `src/modules/reports/`
- **Controllers:**
  - `ReportController.js` - Generaci√≥n de reportes
  
- **Services:**
  - `SalesReportService.js` - Reportes de ventas
  - `PurchaseReportService.js` - Reportes de compras
  - `ProfitabilityService.js` - C√°lculo de m√°rgenes
  - `ExportService.js` - Generaci√≥n PDF/Excel
  
- **Routes:**
  - `GET /api/reports/sales` - Reporte de ventas
  - `GET /api/reports/purchases` - Reporte de compras
  - `GET /api/reports/profitability` - An√°lisis de rentabilidad
  - `GET /api/reports/export/pdf` - Exportar a PDF
  - `GET /api/reports/export/excel` - Exportar a Excel

**Base de Datos (PostgreSQL):**
- **Consultas:**
  - Joins entre ventas, productos, clientes
  - Joins entre compras, proveedores, productos
  - Agregaciones con SUM, AVG, COUNT
  - Vistas materializadas para reportes pesados

---

### M√≥dulo 05: CRM y Atenci√≥n al Cliente

**Frontend (React):**
- **Rutas:**
  - `/crm` - Dashboard de CRM
  - `/crm/customers` - Gesti√≥n de clientes
  - `/crm/loyalty` - Programa de fidelizaci√≥n
  - `/crm/complaints` - Gesti√≥n de reclamos
  - `/crm/surveys` - Encuestas de satisfacci√≥n
  
- **Componentes:**
  - `CustomerList.jsx` - Lista de clientes
  - `CustomerForm.jsx` - Formulario de cliente
  - `LoyaltyProgram.jsx` - Gesti√≥n de puntos
  - `ComplaintsList.jsx` - Lista de reclamos
  - `ComplaintForm.jsx` - Formulario de reclamo
  - `SurveyForm.jsx` - Creaci√≥n de encuestas
  
- **Servicios:**
  - `crmService.js` - Operaciones CRM
  - `loyaltyService.js` - Programa de fidelizaci√≥n

**Backend (Node.js/Express):**
- **M√≥dulo:** `src/modules/crm/`
- **Controllers:**
  - `CustomerController.js` - CRUD de clientes
  - `LoyaltyController.js` - Programa de puntos
  - `ComplaintController.js` - Gesti√≥n de reclamos
  - `SurveyController.js` - Encuestas
  
- **Services:**
  - `CustomerService.js` - L√≥gica de clientes
  - `LoyaltyService.js` - Acumulaci√≥n de puntos
  - `ComplaintService.js` - Flujo de reclamos
  - `SurveyService.js` - Env√≠o de encuestas
  - `NotificationService.js` - Env√≠o de emails
  
- **Routes:**
  - `GET /api/crm/customers` - Listar clientes
  - `POST /api/crm/customers` - Crear cliente
  - `GET /api/crm/loyalty/:customerId` - Consultar puntos
  - `POST /api/crm/complaints` - Registrar reclamo
  - `POST /api/crm/surveys` - Crear encuesta

**Base de Datos (PostgreSQL):**
- **Tablas:**
  - `clientes` - Datos de clientes
  - `puntos` - Programa de fidelizaci√≥n
  - `reclamos` - Gesti√≥n de reclamos
  - `encuestas` - Encuestas de satisfacci√≥n
  - `interacciones` - Historial de interacciones

**Servicios Externos:**
- **EmailJS:** Env√≠o de encuestas y notificaciones

**Eventos Escuchados:**
- `VentaConfirmada` ‚Üí Acumula puntos de fidelizaci√≥n

---

### M√≥dulo Transversal: Autenticaci√≥n y Autorizaci√≥n

**Frontend (React):**
- **Rutas:**
  - `/login` - P√°gina de inicio de sesi√≥n
  - `/register` - Registro de nuevos usuarios (admin only)
  
- **Componentes:**
  - `LoginForm.jsx` - Formulario de login
  - `AuthContext.jsx` - Context de autenticaci√≥n global
  - `PrivateRoute.jsx` - Componente de protecci√≥n de rutas
  
- **Servicios:**
  - `authService.js` - Login, logout, refresh token

**Backend (Node.js/Express):**
- **M√≥dulo:** `src/modules/auth/`
- **Controllers:**
  - `AuthController.js` - Login, registro, refresh
  
- **Services:**
  - `AuthService.js` - L√≥gica de autenticaci√≥n
  - `TokenService.js` - Generaci√≥n y validaci√≥n JWT
  
- **Middlewares:**
  - `authMiddleware.js` - Validaci√≥n de JWT
  - `rbacMiddleware.js` - Control de acceso por rol
  
- **Routes:**
  - `POST /api/auth/login` - Iniciar sesi√≥n
  - `POST /api/auth/register` - Registrar usuario
  - `POST /api/auth/refresh` - Renovar token
  - `GET /api/auth/me` - Obtener usuario actual

**Base de Datos (PostgreSQL):**
- **Tablas:**
  - `usuarios` - Credenciales y datos de usuarios
  - `roles` - Roles y permisos
  - `sesiones` - Tokens activos (refresh tokens)

---

### Diagrama de Flujo de Datos

**Flujo t√≠pico de operaci√≥n:**

1. Usuario accede al **Frontend** (React)
2. Frontend verifica token en **AuthContext**
3. Si es v√°lido, Frontend llama **Backend API** (Express)
4. Backend valida JWT en **authMiddleware**
5. Backend ejecuta **Service** correspondiente
6. Service consulta/modifica **PostgreSQL**
7. Service emite **eventos de dominio** (si aplica)
8. Otros m√≥dulos escuchan y reaccionan a eventos
9. Backend retorna respuesta al Frontend
10. Frontend actualiza UI con los datos

---

[‚¨ÖÔ∏è Anterior](../7.1/7.1.md) | [üè† Home](../../README.md)