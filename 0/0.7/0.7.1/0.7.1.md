> [0. Acerca del Grupo](../../0.md) â€º [0.7. Trabajo Individual (Patrones Cloud)](../0.7.md) â€º [0.7.1. Integrante 1](0.7.1.md)

# 0.7.1. Integrante 1

# PatrÃ³n Cloud: Throttling (Rate Limiting)

## Problema  
En escenarios de alta concurrencia â€”como campaÃ±as de venta, ferias o eventos institucionalesâ€”, mÃºltiples usuarios interactÃºan simultÃ¡neamente con el sistema **InnovaLogix Retail ERP**, accediendo a endpoints crÃ­ticos como:  
- `/api/ventas` (registro de venta rÃ¡pida),  
- `/api/inventario/search` (consulta de stock),  
- `/api/reportes/export` (generaciÃ³n de reportes).  

Sin un control adecuado, estas solicitudes simultÃ¡neas pueden causar:  
- Sobrecarga del servidor y la base de datos.  
- Lentitud en la respuesta o bloqueos totales.  
- Fallos de disponibilidad y pÃ©rdida de informaciÃ³n.  
- DisminuciÃ³n de la experiencia del usuario final.

El sistema necesita un mecanismo que **regule el flujo de solicitudes** para mantener la estabilidad, evitar colapsos y asegurar un rendimiento constante.

---

## SoluciÃ³n: PatrÃ³n Throttling  
El patrÃ³n **Throttling** o **Rate Limiting** controla la **tasa de solicitudes** que pueden procesarse en un periodo determinado.  
Su objetivo es **proteger los recursos** del sistema y **mantener el rendimiento** estable frente a picos de demanda.

### Principio de funcionamiento  
- Se asigna un **lÃ­mite de peticiones** por usuario, IP o token.  
- Si se supera el lÃ­mite, el sistema responde con `HTTP 429 Too Many Requests`.  
- Los lÃ­mites pueden configurarse por **ventanas de tiempo** (por ejemplo, 10 solicitudes cada segundo).  
- Se utiliza un **almacenamiento distribuido** (como **Redis**) para sincronizar los contadores entre distintas instancias del backend.  

### Beneficios  
- Evita saturaciÃ³n en mÃ³dulos crÃ­ticos.  
- Mantiene la latencia del sistema bajo control.  
- AÃ­sla usuarios o integraciones abusivas.  
- Mejora la escalabilidad general del sistema.  
- Protege la experiencia del usuario incluso en condiciones extremas.

---

## Casos de AplicaciÃ³n  
El patrÃ³n **Throttling** se aplica en mÃºltiples contextos de software empresarial:

| Caso | Ejemplo de aplicaciÃ³n |
|------|------------------------|
| **Retail / POS** | Limitar solicitudes simultÃ¡neas de registro de venta. |
| **E-commerce** | Evitar ataques de fuerza bruta en el login o pagos. |
| **APIs pÃºblicas** | Asignar cuotas de consumo por usuario o clave API. |
| **Reportes o descargas** | Evitar saturaciÃ³n en generaciÃ³n de archivos pesados. |

---

## AplicaciÃ³n en *InnovaLogix Retail ERP*  

### Contexto  
En el proyecto grupal **InnovaLogix**, el patrÃ³n se integrarÃ¡ en el **mÃ³dulo de Ventas RÃ¡pidas** y otros endpoints que realizan operaciones intensivas en la base de datos.

### ImplementaciÃ³n propuesta

| Endpoint | LÃ­mite | Clave usada | PropÃ³sito |
|-----------|---------|-------------|------------|
| `/api/ventas` | 8 req/s | userId (JWT) | Evita doble registro o ventas duplicadas. |
| `/api/inventario/search` | 20 req/10s | userId/IP | Controla bÃºsquedas excesivas de productos. |
| `/api/reportes/export` | 2 req/min (por usuario) | userId/global | Protege la generaciÃ³n de reportes. |
| `/api/auth/login` | 5 req/min | IP | Previene ataques de fuerza bruta. |

El patrÃ³n se aplicarÃ¡ mediante **middlewares** en **Node.js + Express**, usando la librerÃ­a `rate-limiter-flexible` y Redis como almacenamiento distribuido.

---

## Ejemplo de implementaciÃ³n en Express

```js
import express from "express";
import { RateLimiterRedis } from "rate-limiter-flexible";
import Redis from "ioredis";

const app = express();
const redis = new Redis();

const ventasLimiter = new RateLimiterRedis({
  storeClient: redis,
  keyPrefix: "rl_ventas",
  points: 8,      // MÃ¡x. 8 solicitudes
  duration: 1     // por segundo
});

app.post("/api/ventas", async (req, res) => {
  try {
    await ventasLimiter.consume(req.ip);
    res.json({ ok: true, msg: "Venta registrada correctamente" });
  } catch {
    res.status(429).json({
      error: "too_many_requests",
      message: "Has superado el lÃ­mite, intenta nuevamente en unos segundos."
    });
  }
});

app.listen(3000, () => console.log("Servidor ejecutÃ¡ndose en el puerto 3000"));


[ğŸ  Home](../../../README.md) | [Siguiente â¡ï¸](../0.7.2/0.7.2.md)
