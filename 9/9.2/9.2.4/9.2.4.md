> [9. Metodolog√≠a de Dise√±o de Arquitectura - Aplicaci√≥n de ADD](../../9.md) ‚Ä∫ [9.2. Iteraci√≥n 1: Definir la estructura general del sistema](../9.2.md) ‚Ä∫ [9.2.4. Elementos instanciados](9.2.4.md)

# 9.2.4. Elementos instanciados

## Elementos Arquitect√≥nicos Instanciados

Esta secci√≥n detalla los elementos concretos del sistema InnovaLogix Retail ERP que resultan de aplicar los conceptos de dise√±o definidos en la iteraci√≥n 1.

### M√≥dulos Funcionales Instanciados

#### 1. M√≥dulo de Ventas R√°pidas (POS)

**Componentes Frontend:**
- `POSInterface.jsx` - Interfaz principal del punto de venta
- `ProductSearch.jsx` - B√∫squeda de productos con autocompletado
- `ShoppingCart.jsx` - Carrito de compra con c√°lculos
- `PaymentModal.jsx` - Procesamiento de pagos m√∫ltiples
- `ReceiptViewer.jsx` - Visualizaci√≥n de comprobantes
- `OfflineQueue.js` - Gestor de cola de sincronizaci√≥n

**Componentes Backend:**
- `SalesController` - Endpoints REST para ventas
- `SalesService` - L√≥gica de negocio de ventas
- `ReceiptService` - Generaci√≥n de PDFs con pdfmake
- `PaymentService` - Validaci√≥n de pagos
- `DiscountService` - C√°lculo de descuentos y combos
- `SalesRepository` - Acceso a datos con Sequelize

**Modelos de Datos:**
- `Venta` (id, fecha, total, usuario_id, cliente_id)
- `DetalleVenta` (id, venta_id, producto_id, cantidad, precio, subtotal)
- `Comprobante` (id, venta_id, tipo, serie, numero, pdf_path)
- `Pago` (id, venta_id, metodo, monto)

---

#### 2. M√≥dulo de Inventario

**Componentes Frontend:**
- `ProductCatalog.jsx` - Lista de productos con filtros
- `ProductForm.jsx` - Formulario de productos/variantes
- `StockControl.jsx` - Ajuste de stock por ubicaci√≥n
- `KardexReport.jsx` - Historial de movimientos
- `AlertsList.jsx` - Alertas de stock m√≠nimo
- `PriceSeasonForm.jsx` - Precios por temporada

**Componentes Backend:**
- `CatalogController` - CRUD de productos
- `StockController` - Control de stock
- `KardexController` - Movimientos hist√≥ricos
- `CatalogService` - Gesti√≥n de cat√°logo
- `StockService` - Operaciones de stock con validaciones
- `KardexService` - Registro autom√°tico de movimientos
- `AlertService` - Detecci√≥n y notificaci√≥n de stock bajo
- `InventoryRepository` - Acceso a datos

**Modelos de Datos:**
- `Producto` (id, nombre, descripcion, categoria, marca)
- `Variante` (id, producto_id, talla, color, sku)
- `Stock` (id, variante_id, ubicacion_id, cantidad, stock_minimo)
- `Ubicacion` (id, nombre, tipo, zona)
- `Kardex` (id, producto_id, tipo_movimiento, cantidad, fecha, usuario_id)
- `PrecioTemporada` (id, variante_id, temporada, precio, descuento)

---

#### 3. M√≥dulo de Compras

**Componentes Frontend:**
- `SuppliersList.jsx` - Gesti√≥n de proveedores
- `SupplierForm.jsx` - Formulario de proveedor
- `PurchaseOrderList.jsx` - Lista de √≥rdenes
- `PurchaseOrderForm.jsx` - Nueva orden de compra
- `OrderApproval.jsx` - Flujo de aprobaci√≥n
- `PriceHistoryChart.jsx` - Hist√≥rico de precios

**Componentes Backend:**
- `SuppliersController` - CRUD de proveedores
- `OrdersController` - Gesti√≥n de √≥rdenes
- `SuppliersService` - L√≥gica de proveedores
- `OrdersService` - Creaci√≥n y aprobaci√≥n de √≥rdenes
- `ApprovalService` - M√°quina de estados de √≥rdenes
- `PriceHistoryService` - Registro de precios hist√≥ricos
- `PurchaseRepository` - Acceso a datos

**Modelos de Datos:**
- `Proveedor` (id, razon_social, ruc, contacto, email, telefono)
- `Compra` (id, proveedor_id, fecha, total, estado)
- `DetalleCompra` (id, compra_id, producto_id, cantidad, precio_unitario)
- `HistorialPrecios` (id, proveedor_id, producto_id, precio, fecha)

---

#### 4. M√≥dulo de Reportes

**Componentes Frontend:**
- `ReportDashboard.jsx` - Dashboard con m√©tricas
- `SalesReport.jsx` - Reporte de ventas con filtros
- `PurchasesReport.jsx` - Reporte de compras
- `ProfitabilityChart.jsx` - Gr√°ficos de rentabilidad
- `ExportButtons.jsx` - Exportaci√≥n PDF/Excel
- `DateRangeFilter.jsx` - Filtro de fechas

**Componentes Backend:**
- `ReportController` - Endpoints de reportes
- `SalesReportService` - Agregaciones de ventas
- `PurchaseReportService` - Agregaciones de compras
- `ProfitabilityService` - C√°lculos de m√°rgenes
- `ExportService` - Generaci√≥n de PDFs con pdfmake y Excel con exceljs
- `ReportRepository` - Consultas con joins complejos

**Consultas Principales:**
- Ventas por per√≠odo (d√≠a, semana, mes)
- Productos m√°s vendidos (top 10)
- An√°lisis de rentabilidad por producto
- Compras por proveedor
- Tendencias temporales

---

#### 5. M√≥dulo de CRM

**Componentes Frontend:**
- `CustomerList.jsx` - Lista de clientes
- `CustomerForm.jsx` - Formulario de cliente
- `LoyaltyProgram.jsx` - Gesti√≥n de puntos
- `ComplaintsList.jsx` - Lista de reclamos
- `ComplaintForm.jsx` - Formulario de reclamo
- `SurveyForm.jsx` - Creaci√≥n de encuestas

**Componentes Backend:**
- `CustomerController` - CRUD de clientes
- `LoyaltyController` - Programa de puntos
- `ComplaintController` - Gesti√≥n de reclamos
- `SurveyController` - Encuestas de satisfacci√≥n
- `CustomerService` - L√≥gica de clientes
- `LoyaltyService` - Acumulaci√≥n/canje de puntos
- `ComplaintService` - Seguimiento de reclamos
- `NotificationService` - Env√≠o de emails con EmailJS
- `CRMRepository` - Acceso a datos

**Modelos de Datos:**
- `Cliente` (id, nombre, email, telefono, documento, fecha_registro)
- `Puntos` (id, cliente_id, puntos_acumulados, puntos_canjeados)
- `Reclamo` (id, cliente_id, venta_id, tipo, descripcion, estado, fecha)
- `Encuesta` (id, cliente_id, tipo, respuestas_json, puntuacion, fecha)
- `Interaccion` (id, cliente_id, tipo, canal, descripcion, fecha)

---

### Componentes Transversales Instanciados

#### Autenticaci√≥n y Autorizaci√≥n

**Componentes:**
- `AuthController` - Login, register, refresh token
- `AuthService` - Validaci√≥n de credenciales, generaci√≥n JWT
- `TokenService` - Creaci√≥n y verificaci√≥n de tokens
- `authMiddleware.js` - Verificaci√≥n de JWT en requests
- `rbacMiddleware.js` - Validaci√≥n de permisos por rol

**Modelos:**
- `Usuario` (id, nombre, email, password_hash, rol_id, activo)
- `Rol` (id, nombre, permisos_json)
- `Sesion` (id, usuario_id, refresh_token, expira_en)

#### Event Bus (Comunicaci√≥n entre M√≥dulos)

**Implementaci√≥n:**
- `EventEmitter` de Node.js como bus de eventos interno
- Eventos definidos como constantes en `src/shared/events/eventTypes.js`
- Listeners registrados en inicializaci√≥n de cada m√≥dulo

**Eventos Configurados:**
```javascript
// Ventas
events.on('VentaConfirmada', (venta) => {
  StockService.actualizarStock(venta); // Descuenta stock
  LoyaltyService.acumularPuntos(venta); // Suma puntos cliente
  KardexService.registrarSalida(venta); // Registra movimiento
});

// Compras
events.on('CompraConfirmada', (compra) => {
  StockService.incrementarStock(compra); // Aumenta stock
  KardexService.registrarEntrada(compra); // Registra movimiento
});

// Stock
events.on('StockBajo', (producto) => {
  AlertService.notificarAlmacenero(producto); // Env√≠a alerta
});
```

#### Logging y Auditor√≠a

**Implementaci√≥n:**
- Winston para logging estructurado (console + file)
- Tabla `auditoria` en PostgreSQL para operaciones cr√≠ticas
- Middleware de logging en todas las rutas protegidas

**Niveles de Log:**
- `error`: Errores cr√≠ticos (500, excepciones)
- `warn`: Advertencias (validaciones fallidas)
- `info`: Operaciones exitosas (login, ventas, compras)
- `debug`: Informaci√≥n de debugging (solo desarrollo)

---

### Infraestructura Instanciada

#### Base de Datos PostgreSQL

**Instancia:** Render PostgreSQL 15
**Configuraci√≥n:**
- Max connections: 20
- Connection pool: 5-10 (Sequelize)
- SSL mode: require
- Backups: diarios (7 d√≠as retenci√≥n)

**√çndices Creados:**
```sql
CREATE INDEX idx_ventas_fecha ON ventas(fecha);
CREATE INDEX idx_ventas_usuario ON ventas(usuario_id);
CREATE INDEX idx_productos_sku ON variantes(sku);
CREATE INDEX idx_stock_ubicacion ON stock(ubicacion_id);
CREATE INDEX idx_kardex_fecha ON kardex(fecha);
```

#### Servidores de Aplicaci√≥n

**Frontend (Vercel):**
- Build command: `npm run build`
- Output directory: `dist`
- Node version: 18.x
- Environment variables: VITE_API_URL

**Backend (Render):**
- Start command: `npm start`
- Node version: 18.x
- Instance type: Starter (512MB RAM)
- Environment variables: DATABASE_URL, JWT_SECRET, PORT

---

### APIs y Endpoints Instanciados

**Resumen por M√≥dulo:**

| M√≥dulo | GET | POST | PUT/PATCH | DELETE | Total |
|--------|-----|------|-----------|--------|-------|
| Auth | 1 | 3 | 1 | 0 | 5 |
| Sales | 4 | 2 | 1 | 1 | 8 |
| Inventory | 6 | 3 | 2 | 1 | 12 |
| Purchases | 5 | 3 | 2 | 1 | 11 |
| Reports | 6 | 0 | 0 | 0 | 6 |
| CRM | 5 | 4 | 2 | 1 | 12 |
| **Total** | **27** | **15** | **8** | **4** | **54** |

---

### Librer√≠as y Dependencias Instanciadas

**Frontend:**
```json
{
  "react": "18.2.0",
  "react-router-dom": "6.14.0",
  "axios": "1.4.0",
  "chart.js": "4.3.0",
  "react-chartjs-2": "5.2.0",
  "react-hook-form": "7.45.0",
  "yup": "1.2.0",
  "react-toastify": "9.1.3",
  "date-fns": "2.30.0"
}
```

**Backend:**
```json
{
  "express": "4.18.2",
  "sequelize": "6.32.1",
  "pg": "8.11.1",
  "jsonwebtoken": "9.0.1",
  "bcrypt": "5.1.0",
  "joi": "17.9.2",
  "pdfmake": "0.2.8",
  "exceljs": "4.3.0",
  "nodemailer": "6.9.4",
  "winston": "3.10.0"
}
```

---

[‚¨ÖÔ∏è Anterior](../9.2.3/9.2.3.md) | [üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../9.2.5/9.2.5.md)