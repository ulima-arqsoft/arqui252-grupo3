> [9. Metodolog√≠a de Dise√±o de Arquitectura - Aplicaci√≥n de ADD](../../9.md) ‚Ä∫ [9.2. Iteraci√≥n 1: Definir la estructura general del sistema](../9.2.md) ‚Ä∫ [9.2.3. Conceptos de dise√±o](9.2.3.md)

# 9.2.3. Conceptos de dise√±o

## Conceptos de Dise√±o para la Estructura General del Sistema

Esta secci√≥n documenta los principales conceptos de dise√±o y decisiones arquitect√≥nicas tomadas para establecer la estructura general del sistema InnovaLogix Retail ERP.

### DEC-1: Arquitectura Monol√≠tica Modular

**Concepto:** Estructura monol√≠tica con separaci√≥n l√≥gica clara entre m√≥dulos funcionales

**Decisi√≥n:** Implementar una arquitectura monol√≠tica modular con separaci√≥n por capas (presentaci√≥n, negocio, datos) y m√≥dulos funcionales claramente definidos (Ventas, Inventario, Compras, Reportes, CRM).

**Justificaci√≥n:**
- Simplicidad de desarrollo y despliegue para equipo peque√±o
- Menor complejidad operativa que microservicios
- Facilita transacciones y consistencia de datos
- Preparado para futura migraci√≥n a microservicios (boundaries definidos)
- Adecuado para escala inicial del negocio (tienda retail mediana)

**Patrones aplicados:**
- Layered Architecture (capas)
- Domain-Driven Design (m√≥dulos por dominio)
- Separation of Concerns

---

### DEC-2: Comunicaci√≥n mediante API REST

**Concepto:** Frontend y Backend desacoplados comunic√°ndose via API REST

**Decisi√≥n:** Implementar API REST como interfaz de comunicaci√≥n entre el frontend React y el backend Node.js/Express.

**Justificaci√≥n:**
- Est√°ndar ampliamente adoptado y documentado
- Facilita integraci√≥n con futuros clientes (m√≥vil, web alternativa)
- Permite escalado independiente de frontend y backend
- Cacheable por naturaleza (HTTP caching)
- Stateless - facilita balanceo de carga futuro

**Endpoints dise√±ados:**
- `/api/auth/*` - Autenticaci√≥n y autorizaci√≥n
- `/api/sales/*` - Operaciones de ventas
- `/api/inventory/*` - Gesti√≥n de inventario
- `/api/purchases/*` - Gesti√≥n de compras
- `/api/reports/*` - Generaci√≥n de reportes
- `/api/crm/*` - Gesti√≥n de clientes

---

### DEC-3: Base de Datos Relacional Centralizada (PostgreSQL)

**Concepto:** PostgreSQL como base de datos centralizada para todos los m√≥dulos

**Decisi√≥n:** Utilizar PostgreSQL 15 como √∫nica base de datos relacional, con schemas l√≥gicos por m√≥dulo pero almacenamiento f√≠sico centralizado.

**Justificaci√≥n:**
- Integridad referencial garantizada (foreign keys, constraints)
- Transacciones ACID cr√≠ticas para operaciones financieras
- Consultas complejas facilitadas (joins, agregaciones)
- Soporte excelente de Sequelize ORM
- Backups y recuperaci√≥n simplificados
- Evita complejidad de sincronizaci√≥n entre m√∫ltiples DBs

**Organizaci√≥n de datos:**
- Schema √∫nico `public` con tablas prefijadas por m√≥dulo
- √çndices optimizados en columnas frecuentemente consultadas
- Vistas materializadas para reportes complejos

---

### DEC-4: Stack Tecnol√≥gico Unificado (MERN adaptado)

**Concepto:** JavaScript/TypeScript en todo el stack

**Decisi√≥n:** React (frontend) + Node.js/Express (backend) + PostgreSQL (datos) como stack principal.

**Justificaci√≥n:**
- Un solo lenguaje (JavaScript) facilita onboarding y mantenimiento
- Ecosistema npm rico en bibliotecas
- Curva de aprendizaje reducida para equipo
- Reutilizaci√≥n de c√≥digo entre frontend y backend (validaciones, utils)
- Comunidad activa y amplia documentaci√≥n
- Experiencia previa del equipo

**Tecnolog√≠as complementarias:**
- Sequelize ORM para PostgreSQL
- JWT para autenticaci√≥n stateless
- Axios para HTTP requests
- Chart.js para visualizaciones

---

### DEC-5: Modularizaci√≥n por Dominios Funcionales

**Concepto:** Organizaci√≥n del c√≥digo por m√≥dulos de negocio

**Decisi√≥n:** Estructurar el c√≥digo en 5 m√≥dulos principales que reflejan los subdominios del negocio: Ventas R√°pidas, Inventario, Compras, CRM y Reportes.

**Justificaci√≥n:**
- Alineaci√≥n con la estructura organizacional del cliente
- Cada m√≥dulo puede evolucionar independientemente
- Facilita asignaci√≥n de responsabilidades en el equipo
- Boundaries claros para futura extracci√≥n a microservicios
- Reduce acoplamiento entre funcionalidades

**Estructura de m√≥dulos:**
```
backend/
  src/
    modules/
      auth/
      sales/
      inventory/
      purchases/
      reports/
      crm/
```

---

### DEC-6: Soporte para Operaci√≥n Offline

**Concepto:** Capacidad de operar sin conexi√≥n a internet

**Decisi√≥n:** Implementar Progressive Web App (PWA) con IndexedDB para almacenamiento local y sincronizaci√≥n diferida.

**Justificaci√≥n:**
- Requisito cr√≠tico del negocio (RF6)
- Ferias y eventos suelen tener conectividad inestable
- Evita p√©rdida de ventas por problemas de red
- Mejora experiencia de usuario (no bloqueos)
- Service Workers permiten funcionamiento offline

**Mecanismo de sincronizaci√≥n:**
1. Operaci√≥n se almacena en IndexedDB
2. Service Worker detecta recuperaci√≥n de conexi√≥n
3. Queue se procesa autom√°ticamente
4. Confirmaci√≥n al usuario de sincronizaci√≥n exitosa

---

### DEC-7: Eventos de Dominio para Comunicaci√≥n entre M√≥dulos

**Concepto:** Comunicaci√≥n as√≠ncrona mediante eventos

**Decisi√≥n:** Utilizar patr√≥n Event-Driven con Node.js EventEmitter para comunicaci√≥n entre m√≥dulos dentro del monolito.

**Justificaci√≥n:**
- Desacoplamiento entre m√≥dulos emisores y consumidores
- Facilita extensibilidad (nuevos listeners sin modificar emisores)
- Preparaci√≥n para futuro message broker (Kafka, RabbitMQ)
- Auditor√≠a y trazabilidad simplificada
- Evita dependencias c√≠clicas entre m√≥dulos

**Eventos principales:**
- `VentaConfirmada` ‚Üí Inventario, CRM
- `CompraConfirmada` ‚Üí Inventario
- `ClienteRegistrado` ‚Üí CRM
- `StockBajo` ‚Üí Compras (sugerencias)

---

### DEC-8: Autenticaci√≥n Basada en Tokens (JWT)

**Concepto:** Autenticaci√≥n stateless con JSON Web Tokens

**Decisi√≥n:** Implementar autenticaci√≥n JWT con tokens de acceso (8h) y refresh tokens (7 d√≠as).

**Justificaci√≥n:**
- Stateless - no requiere sesiones en servidor
- Escalable horizontalmente (no session affinity)
- Puede incluir claims del usuario (roles, permisos)
- Compatible con arquitecturas distribuidas
- Soporta m√∫ltiples clientes (web, m√≥vil futuro)

**Flujo de autenticaci√≥n:**
1. Login ‚Üí genera access token + refresh token
2. Cada request incluye access token en header
3. Al expirar access token, se usa refresh token
4. Refresh token rotation para mayor seguridad

---

### DEC-9: Control de Acceso Basado en Roles (RBAC)

**Concepto:** Autorizaci√≥n mediante roles y permisos

**Decisi√≥n:** Implementar RBAC con 5 roles principales: Admin, Gerente, Cajero, Almacenero, Vendedor.

**Justificaci√≥n:**
- Seguridad granular por funcionalidad
- Separaci√≥n de responsabilidades
- Auditor√≠a de acciones por rol
- Facilita compliance y regulaciones
- Extensible para nuevos roles

**Matriz de permisos:**
- Admin: acceso total
- Gerente: reportes + configuraci√≥n
- Cajero: ventas + consultas b√°sicas
- Almacenero: inventario + compras
- Vendedor: ventas + consulta clientes

---

### DEC-10: Validaci√≥n en Dos Capas

**Concepto:** Validaci√≥n tanto en frontend como backend

**Decisi√≥n:** Implementar validaci√≥n de datos en ambas capas con React Hook Form (frontend) y Joi (backend).

**Justificaci√≥n:**
- Frontend: UX mejorada con feedback inmediato
- Backend: Seguridad - nunca confiar en el cliente
- Schemas reutilizables entre capas
- Protecci√≥n contra manipulaci√≥n de requests
- Previene datos inconsistentes en BD

**Validaciones comunes:**
- Campos requeridos
- Formatos (email, tel√©fono, RUC)
- Rangos num√©ricos (precios positivos, stock >= 0)
- Longitudes de texto
- Unicidad (emails, SKUs)

---

### DEC-11: Logging y Auditor√≠a Centralizada

**Concepto:** Registro completo de operaciones cr√≠ticas

**Decisi√≥n:** Implementar logging estructurado con Winston y tabla de auditor√≠a en PostgreSQL.

**Justificaci√≥n:**
- Trazabilidad completa de operaciones financieras
- Debugging facilitado con logs estructurados
- Cumplimiento con auditor√≠as fiscales
- Detecci√≥n de anomal√≠as y fraudes
- An√°lisis de comportamiento de usuarios

**Informaci√≥n registrada:**
- Timestamp preciso
- Usuario responsable
- Operaci√≥n ejecutada (CRUD)
- Entidad afectada
- Cambios realizados (before/after)
- IP y user agent

---

### DEC-12: Deployment en Plataformas Cloud

**Concepto:** Despliegue en servicios PaaS

**Decisi√≥n:** Vercel (frontend) + Render (backend + DB) como plataformas de deployment.

**Justificaci√≥n:**
- Zero-config deployment (push-to-deploy)
- HTTPS/SSL autom√°tico
- CDN global incluido (Vercel)
- Backups autom√°ticos de BD
- Costos predecibles y escalables
- Ideal para MVP y validaci√≥n

**Ambientes:**
- Development: localhost
- Staging: preview deployments
- Production: main branch

---

### Resumen de Decisiones

| ID | Decisi√≥n | Patr√≥n/Tecnolog√≠a | Impacto |
|----|----------|-------------------|---------|
| DEC-1 | Arquitectura Monol√≠tica Modular | Layered + DDD | Alto |
| DEC-2 | API REST | REST API | Alto |
| DEC-3 | PostgreSQL Centralizado | RDBMS | Alto |
| DEC-4 | Stack MERN | React + Node | Alto |
| DEC-5 | Modularizaci√≥n por Dominio | DDD Modules | Alto |
| DEC-6 | Soporte Offline | PWA + IndexedDB | Medio |
| DEC-7 | Eventos de Dominio | Event-Driven | Medio |
| DEC-8 | JWT Authentication | JWT | Medio |
| DEC-9 | RBAC | Role-Based Access | Medio |
| DEC-10 | Validaci√≥n Dos Capas | Validation | Medio |
| DEC-11 | Logging y Auditor√≠a | Audit Trail | Bajo |
| DEC-12 | Cloud Deployment | PaaS | Bajo |

---

[‚¨ÖÔ∏è Anterior](../9.2.2/9.2.2.md) | [üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../9.2.4/9.2.4.md)