> [9. Metodolog√≠a de Dise√±o de Arquitectura - Aplicaci√≥n de ADD](../../9.md) ‚Ä∫ [9.3. Iteraci√≥n 2: Identificar estructuras para soportar la funcionalidad primaria](../9.3.md) ‚Ä∫ [9.3.3. Conceptos de dise√±o](9.3.3.md)

# 9.3.3. Conceptos de dise√±o
<h1>9.3.3. Conceptos de dise√±o</h1>

<p>
Esta secci√≥n documenta los conceptos de dise√±o y decisiones arquitect√≥nicas aplicadas para refinar la funcionalidad primaria del sistema <strong>InnovaLogix Retail ERP</strong> durante la Iteraci√≥n 2 del proceso ADD. Las decisiones se centran en garantizar <strong>consistencia del stock</strong>, <strong>trazabilidad (kardex)</strong>, <strong>rendimiento</strong>, <strong>seguridad</strong> y <strong>sincronizaci√≥n entre microservicios</strong>.
</p>

<hr>

<h2>DEC-1: Consistencia Transaccional entre POS e Inventory</h2>

<p><strong>Concepto:</strong><br>
Garantizar que las ventas y compras actualicen el stock correctamente.</p>

<p><strong>Decisi√≥n:</strong><br>
Uso de transacciones ACID en PostgreSQL y validaci√≥n previa de stock en Inventory.</p>

<p><strong>Justificaci√≥n:</strong></p>
<ul>
  <li>Evita ventas con stock insuficiente.</li>
  <li>Asegura coherencia entre stock, kardex y ventas.</li>
  <li>Previene condiciones de carrera.</li>
</ul>

<p><strong>Patr√≥n aplicado:</strong> Transactional Outbox (simplificado) + validaci√≥n previa.</p>

<hr>

<h2>DEC-2: Kardex como Registro Inmutable</h2>

<p><strong>Concepto:</strong><br>
Registrar todos los movimientos de inventario como un log inmutable.</p>

<p><strong>Decisi√≥n:</strong><br>
Kardex funciona solo con inserciones (entradas/salidas).</p>

<p><strong>Justificaci√≥n:</strong></p>
<ul>
  <li>Auditor√≠a completa.</li>
  <li>Facilita trazabilidad.</li>
  <li>Evita inconsistencias en hist√≥rico.</li>
</ul>

<p><strong>Patr√≥n aplicado:</strong> Event Sourcing (lightweight).</p>

<hr>

<h2>DEC-3: Cache en Memoria para Cat√°logo y Stock</h2>

<p><strong>Concepto:</strong><br>
Optimizar rendimiento en b√∫squedas frecuentes.</p>

<p><strong>Decisi√≥n:</strong><br>
Uso de <code>node-cache</code> para productos y stock.</p>

<p><strong>Justificaci√≥n:</strong></p>
<ul>
  <li>Latencias &lt; 50 ms.</li>
  <li>Reduce carga en base de datos.</li>
  <li>Mejora experiencia en POS.</li>
</ul>

<p><strong>Patr√≥n aplicado:</strong> Cache-Aside Pattern.</p>

<hr>

<h2>DEC-4: WebSocket para Actualizaci√≥n Instant√°nea de Stock</h2>

<p><strong>Concepto:</strong><br>
Sincronizar stock en tiempo real entre servicios y UI.</p>

<p><strong>Decisi√≥n:</strong><br>
Socket.IO con eventos <code>stockUpdate</code> y <code>lowStockAlert</code>.</p>

<p><strong>Justificaci√≥n:</strong></p>
<ul>
  <li>Actualizaci√≥n inmediata.</li>
  <li>Evita polling.</li>
  <li>Mejora experiencia del usuario.</li>
</ul>

<p><strong>Patr√≥n aplicado:</strong> Observer / Pub-Sub.</p>

<hr>

<h2>DEC-5: API REST con Endpoints Especializados</h2>

<p><strong>Concepto:</strong><br>
Separar responsabilidades mediante endpoints claros.</p>

<p><strong>Decisi√≥n:</strong></p>
<ul>
  <li><code>GET /inventory/stock/:sku</code></li>
  <li><code>POST /inventory/stock/decrement</code></li>
  <li><code>POST /inventory/stock/increment</code></li>
  <li><code>POST /inventory/kardex</code></li>
</ul>

<p><strong>Justificaci√≥n:</strong></p>
<ul>
  <li>Claridad de dominio.</li>
  <li>Testing m√°s simple.</li>
  <li>Menor acoplamiento.</li>
</ul>

<p><strong>Patr√≥n aplicado:</strong> Domain-Driven APIs.</p>

<hr>

<h2>DEC-6: Validaci√≥n Previa de Stock</h2>

<p><strong>Concepto:</strong><br>
Confirmar disponibilidad antes de registrar una venta.</p>

<p><strong>Decisi√≥n:</strong> Endpoint: <code>POST /inventory/validate</code></p>

<p><strong>Justificaci√≥n:</strong></p>
<ul>
  <li>Evita ventas rechazadas.</li>
  <li>Asegura disponibilidad real.</li>
</ul>

<p><strong>Patr√≥n aplicado:</strong> Pre-Condition Validation.</p>

<hr>

<h2>DEC-7: Seguridad para Consultas SQL y Endpoints Cr√≠ticos</h2>

<p><strong>Concepto:</strong><br>
Prevenir inyecciones y manipulaci√≥n indebida de stock.</p>

<p><strong>Decisi√≥n:</strong></p>
<ul>
  <li>Queries parametrizadas.</li>
  <li>Validaci√≥n con Joi.</li>
  <li>Rate limiting en API Gateway.</li>
</ul>

<p><strong>Justificaci√≥n:</strong></p>
<ul>
  <li>Inventory es un dominio cr√≠tico.</li>
  <li>Previene ataques y abusos.</li>
</ul>

<p><strong>Patrones aplicados:</strong> SQL Parametrization, Input Validation Layer, Rate Limiting.</p>

<hr>

<h2>DEC-8: Eventos Internos para Movimientos de Stock</h2>

<p><strong>Concepto:</strong><br>
Habilitar integraci√≥n desacoplada entre servicios.</p>

<p><strong>Decisi√≥n:</strong> Emisi√≥n de eventos:</p>
<ul>
  <li><code>SaleCompleted</code></li>
  <li><code>PurchaseReceived</code></li>
  <li><code>StockUpdated</code></li>
  <li><code>KardexCreated</code></li>
</ul>

<p><strong>Justificaci√≥n:</strong></p>
<ul>
  <li>Reduce acoplamiento POS ‚Üî Inventory.</li>
  <li>Facilita escalabilidad futura.</li>
</ul>

<p><strong>Patr√≥n aplicado:</strong> Event-Driven Integration.</p>

<hr>

<h2>DEC-9: √çndices en PostgreSQL para Rendimiento</h2>

<p><strong>Concepto:</strong><br>
Acelerar consultas de SKU, productos y kardex.</p>

<p><strong>Decisi√≥n:</strong></p>

<pre><code>CREATE INDEX idx_sku ON variantes(sku);
CREATE INDEX idx_producto ON productos(nombre);
CREATE INDEX idx_kardex_fecha ON kardex(fecha);
</code></pre>

<p><strong>Justificaci√≥n:</strong></p>
<ul>
  <li>B√∫squedas de SKU deben ser instant√°neas.</li>
  <li>Kardex crecer√° r√°pidamente.</li>
</ul>

<p><strong>Patr√≥n aplicado:</strong> Database Indexing.</p>

<hr>

<h2>DEC-10: Manejo de Concurrencia en Stock</h2>

<p><strong>Concepto:</strong><br>
Evitar que m√∫ltiples ventas descuenten stock simult√°neamente.</p>

<p><strong>Decisi√≥n:</strong><br>
Uso de bloqueos <code>SELECT ... FOR UPDATE</code>.</p>

<p><strong>Justificaci√≥n:</strong></p>
<ul>
  <li>Evita ventas en negativo.</li>
  <li>Asegura integridad en escenarios concurrentes.</li>
</ul>

<p><strong>Patr√≥n aplicado:</strong> Pessimistic Locking.</p>

<hr>

<h2>Resumen de Decisiones</h2>

<table>
<thead>
<tr>
  <th>ID</th>
  <th>Decisi√≥n</th>
  <th>Impacto</th>
</tr>
</thead>
<tbody>
<tr>
  <td>DEC-1</td>
  <td>Consistencia POS ‚Üî Inventory</td>
  <td>Integridad del stock</td>
</tr>
<tr>
  <td>DEC-2</td>
  <td>Kardex inmutable</td>
  <td>Auditor√≠a y trazabilidad</td>
</tr>
<tr>
  <td>DEC-3</td>
  <td>Cache en memoria</td>
  <td>Rendimiento</td>
</tr>
<tr>
  <td>DEC-4</td>
  <td>WebSocket</td>
  <td>Sincronizaci√≥n instant√°nea</td>
</tr>
<tr>
  <td>DEC-5</td>
  <td>Endpoints especializados</td>
  <td>Claridad de dominio</td>
</tr>
<tr>
  <td>DEC-6</td>
  <td>Validaci√≥n previa</td>
  <td>Prevenci√≥n de errores</td>
</tr>
<tr>
  <td>DEC-7</td>
  <td>Seguridad SQL</td>
  <td>Protecci√≥n del sistema</td>
</tr>
<tr>
  <td>DEC-8</td>
  <td>Eventos internos</td>
  <td>Desacoplamiento</td>
</tr>
<tr>
  <td>DEC-9</td>
  <td>√çndices SQL</td>
  <td>Performance</td>
</tr>
<tr>
  <td>DEC-10</td>
  <td>Manejo de concurrencia</td>
  <td>Evitar ventas negativas</td>
</tr>
</tbody>
</table>


[‚¨ÖÔ∏è Anterior](../9.3.2/9.3.2.md) | [üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../9.3.4/9.3.4.md)
