> [6. Documentaci√≥n de Arquitectura (Bosquejo)](../6.md) ‚Ä∫ [6.3. Diagrama de Componentes](6.3.md)

# 6.3. Diagrama de Componentes

## Diagrama de Componentes - InnovaLogix Retail ERP

El diagrama de componentes muestra la estructura interna de cada m√≥dulo del sistema InnovaLogix Retail ERP, detallando los componentes principales, sus responsabilidades y sus relaciones.

<!-- INSERTAR IMAGEN ACERCA DE: Diagrama de componentes mostrando la estructura interna de los 5 m√≥dulos (Ventas R√°pidas, Inventario, Compras, CRM, Reportes) con sus componentes internos, controladores, servicios y repositorios. Incluir conexiones entre componentes y flujo de datos. -->

### M√≥dulo 01: Ventas R√°pidas (POS Web)

**Componentes principales:**
- **POSController:** Controlador principal que maneja las peticiones HTTP del punto de venta
- **SalesService:** Servicio de l√≥gica de negocio para procesar ventas y aplicar descuentos
- **ReceiptService:** Generador de comprobantes (boletas/facturas) en formato PDF
- **PaymentService:** Procesador de m√©todos de pago (efectivo, tarjeta, mixto)
- **OfflineQueueService:** Gestor de cola local para operaciones sin conexi√≥n
- **SalesRepository:** Capa de acceso a datos para ventas en PostgreSQL

**Relaciones:**
- POSController ‚Üí SalesService ‚Üí SalesRepository
- SalesService ‚Üí ReceiptService (generaci√≥n de comprobantes)
- SalesService ‚Üí PaymentService (procesamiento de pagos)
- SalesService ‚Üí EventEmitter ("VentaConfirmada")
- OfflineQueueService ‚Üí IndexedDB (almacenamiento local)

### M√≥dulo 02: Inventario

**Componentes principales:**
- **InventoryController:** Controlador REST para operaciones de inventario
- **CatalogService:** Gesti√≥n de productos, variantes y precios por temporada
- **StockService:** Control de stock, ubicaciones y alertas de stock m√≠nimo
- **KardexService:** Registro hist√≥rico de movimientos (entradas/salidas)
- **AlertService:** Generador de notificaciones de stock bajo
- **InventoryRepository:** Acceso a datos de productos, stock y kardex

**Relaciones:**
- InventoryController ‚Üí CatalogService, StockService, KardexService
- StockService ‚Üí AlertService (notificaciones)
- EventListener ("VentaConfirmada", "CompraConfirmada") ‚Üí StockService
- StockService ‚Üí KardexService (registro de movimientos)

### M√≥dulo 03: Compras

**Componentes principales:**
- **PurchaseController:** Controlador REST para operaciones de compras
- **SuppliersService:** Gesti√≥n de proveedores y sus datos de contacto
- **OrdersService:** Gesti√≥n de √≥rdenes de compra y estados
- **ApprovalService:** Flujo de aprobaci√≥n de √≥rdenes
- **PriceHistoryService:** Registro hist√≥rico de precios de proveedores
- **PurchaseRepository:** Acceso a datos de compras y proveedores

**Relaciones:**
- PurchaseController ‚Üí SuppliersService, OrdersService
- OrdersService ‚Üí ApprovalService (validaci√≥n de estados)
- OrdersService ‚Üí PriceHistoryService (registro de precios)
- OrdersService ‚Üí EventEmitter ("CompraConfirmada")

### M√≥dulo 04: Reportes

**Componentes principales:**
- **ReportController:** Controlador REST para solicitudes de reportes
- **SalesReportService:** Generador de reportes de ventas
- **PurchaseReportService:** Generador de reportes de compras
- **ProfitabilityService:** Calculador de m√°rgenes y rentabilidad
- **ExportService:** Generador de archivos PDF/Excel
- **ReportRepository:** Consultas agregadas a m√∫ltiples tablas

**Relaciones:**
- ReportController ‚Üí SalesReportService, PurchaseReportService, ProfitabilityService
- Todos los servicios ‚Üí ReportRepository (consultas SQL con joins)
- Todos los servicios ‚Üí ExportService (exportaci√≥n de archivos)
- ReportRepository ‚Üí Ventas, Compras, Inventario, CRM (consultas cruzadas)

### M√≥dulo 05: CRM y Atenci√≥n al Cliente

**Componentes principales:**
- **CRMController:** Controlador REST para operaciones CRM
- **CustomerService:** Gesti√≥n de clientes y sus datos
- **LoyaltyService:** Gesti√≥n de programas de fidelizaci√≥n y puntos
- **ComplaintService:** Gesti√≥n de reclamos y seguimiento
- **SurveyService:** Env√≠o y an√°lisis de encuestas de satisfacci√≥n
- **NotificationService:** Env√≠o de correos y notificaciones
- **CRMRepository:** Acceso a datos de clientes e interacciones

**Relaciones:**
- CRMController ‚Üí CustomerService, LoyaltyService, ComplaintService, SurveyService
- EventListener ("VentaConfirmada") ‚Üí LoyaltyService (acumulaci√≥n de puntos)
- SurveyService ‚Üí NotificationService (env√≠o de encuestas)
- CustomerService ‚Üí CRMRepository

### Componentes Transversales

**Autenticaci√≥n y Autorizaci√≥n:**
- **AuthMiddleware:** Validaci√≥n de JWT en todas las peticiones
- **RBACMiddleware:** Control de acceso basado en roles
- **AuthService:** Generaci√≥n y validaci√≥n de tokens

**Utilidades Compartidas:**
- **Logger:** Registro centralizado de logs
- **ErrorHandler:** Manejo global de errores
- **Validator:** Validaciones de entrada con Joi
- **DateUtils:** Utilidades para manejo de fechas
- **PriceCalculator:** C√°lculos financieros con precisi√≥n decimal

### Flujo de Datos entre Componentes

1. **Cliente (React)** ‚Üí **API REST** ‚Üí **Controller espec√≠fico**
2. **Controller** ‚Üí **Service** (l√≥gica de negocio)
3. **Service** ‚Üí **Repository** (acceso a datos)
4. **Repository** ‚Üí **PostgreSQL** (persistencia)
5. **Service** ‚Üí **EventEmitter** (eventos de dominio)
6. **EventListener** ‚Üí **Service correspondiente** (reacci√≥n a eventos)

### Patrones Aplicados

- **MVC (Model-View-Controller):** Separaci√≥n de presentaci√≥n, l√≥gica y datos
- **Repository Pattern:** Abstracci√≥n del acceso a datos
- **Service Layer:** Encapsulaci√≥n de l√≥gica de negocio
- **Event-Driven Architecture:** Comunicaci√≥n as√≠ncrona entre m√≥dulos
- **Dependency Injection:** Inyecci√≥n de dependencias via constructores

---

[‚¨ÖÔ∏è Anterior](../6.2/6.2.md) | [üè† Home](../../README.md) | [Siguiente ‚û°Ô∏è](../6.4/6.4.md)