> [8. Aplicaci√≥n de Patrones Arquitecturales](../8.md) ‚Ä∫ [8.5. M√≥dulo 5 / Integrante 5](8.5.md)

# 8.5. Patrones del M√≥dulo CRM

## **Decisi√≥n 1: Patr√≥n Strategy para Notificaciones**

**T√≠tulo:**  
Gesti√≥n flexible de canales de notificaci√≥n mediante Strategy

**Contexto:**  
El m√≥dulo CRM de InnovaLogix env√≠a notificaciones a clientes por m√∫ltiples canales: email (promociones, confirmaci√≥n de compra), SMS (c√≥digos de descuento, recordatorios), WhatsApp (estado de pedidos), notificaciones push web (ofertas flash). Cada canal tiene API diferente, l√≠mites de env√≠o y costos variables. El sistema debe permitir agregar canales sin modificar c√≥digo existente y seleccionar canal seg√∫n preferencias del cliente.

**Alternativas:**
1. **Condicionales if/switch por canal:**
   - L√≥gica centralizada con condicionales
   - Cada canal nuevo modifica c√≥digo existente
   - Dificulta testing individual
   - Viola Open/Closed

2. **Patr√≥n Strategy:**
   - Cada canal es estrategia independiente
   - Interfaz com√∫n (enviarNotificacion)
   - Extensible sin modificar c√≥digo
   - Testing aislado por canal

3. **Service Bus:**
   - Cola de mensajes para notificaciones
   - Complejidad de infraestructura
   - Overhead para monolito

**Criterios de elecci√≥n:**
- **Extensibilidad:** Agregar canales f√°cilmente
- **Flexibilidad:** Selecci√≥n din√°mica seg√∫n preferencias
- **Testabilidad:** Pruebas por canal
- **Mantenibilidad:** Aislamiento de l√≥gica de cada canal

**Decisi√≥n:**
Patr√≥n Strategy.

- **Interfaz:** NotificationStrategy con m√©todo enviar(destinatario, mensaje)
- **Estrategias:** EmailStrategy, SMSStrategy, WhatsAppStrategy, PushStrategy
- **Contexto:** NotificationService selecciona estrategia seg√∫n preferencias_notificacion del cliente

**Sustento:**  
Strategy encapsula cada canal de notificaci√≥n: EmailStrategy usa SendGrid API, SMSStrategy integra con Twilio, WhatsAppStrategy usa WhatsApp Business API, PushStrategy env√≠a web push notifications. Al registrar preferencias, cliente elige canales activos. NotificationService itera sobre estrategias activas sin conocer implementaci√≥n. Agregar Telegram o Slack requiere solo nueva clase. Cumple con QAW-05 (agregar canal en menos de 8 horas) y permite testing con mocks de APIs externas.

<!-- INSERTAR IMAGEN ACERCA DE: Diagrama de clases Strategy mostrando NotificationStrategy y sus implementaciones por canal -->

---

## **Decisi√≥n 2: Patr√≥n Observer para Programa de Fidelizaci√≥n**

**T√≠tulo:**  
Actualizaci√≥n autom√°tica de puntos de fidelizaci√≥n mediante Observer

**Contexto:**  
InnovaLogix tiene programa de puntos: clientes acumulan puntos por compras (1 punto por S/ 10), pueden canjearlos por descuentos, suben de nivel (Bronce ‚Üí Plata ‚Üí Oro ‚Üí Platino) seg√∫n puntos acumulados, cada nivel tiene beneficios adicionales. El c√°lculo de puntos debe actualizarse autom√°ticamente tras cada venta sin acoplar m√≥dulo de Ventas con CRM.

**Alternativas:**
1. **Llamada directa desde Ventas:**
   - SalesService invoca CRMService.asignarPuntos()
   - Alto acoplamiento entre m√≥dulos
   - Dificulta modificar l√≥gica de puntos
   - Ventas no debe conocer CRM

2. **Patr√≥n Observer:**
   - SalesService emite evento VentaCompletada
   - CRMObserver reacciona calculando puntos
   - Desacoplamiento completo
   - Extensible a otras acciones (encuestas, cupones)

3. **Job batch nocturno:**
   - C√°lculo de puntos una vez al d√≠a
   - No cumple expectativa de inmediatez
   - Clientes esperan ver puntos al instante

**Criterios de elecci√≥n:**
- **Desacoplamiento:** Independencia Ventas-CRM
- **Inmediatez:** Puntos visibles inmediatamente
- **Extensibilidad:** Agregar acciones post-venta
- **Mantenibilidad:** Modificar reglas sin afectar Ventas

**Decisi√≥n:**
Patr√≥n Observer.

- **Evento:** VentaCompletada emitido por SalesService
- **Observador:** LoyaltyObserver calcula puntos (total_venta / 10), actualiza saldo cliente, verifica cambio de nivel
- **Acciones adicionales:** Enviar notificaci√≥n si sube de nivel, sugerir productos canjeables

**Sustento:**  
Observer permite que CRM reaccione a ventas sin acoplamiento. Cuando venta se completa, LoyaltyObserver calcula puntos autom√°ticamente (venta de S/ 150 = 15 puntos), actualiza saldo del cliente, verifica si alcanz√≥ umbral para siguiente nivel (Plata requiere 500 puntos), y env√≠a notificaci√≥n de felicitaci√≥n si subi√≥. M√≥dulo de Ventas no conoce existencia del programa de fidelizaci√≥n. Futuras acciones post-venta (enviar encuesta de satisfacci√≥n, cup√≥n de cumplea√±os) se agregan como nuevos observadores. Cumple con QAW-04 (mantenibilidad modular).

<!-- INSERTAR IMAGEN ACERCA DE: Diagrama de secuencia mostrando venta completada, evento emitido y LoyaltyObserver actualizando puntos -->

---

[‚¨ÖÔ∏è Anterior](../8.4/8.4.md) | [üè† Home](../../README.md) | [Siguiente ‚û°Ô∏è](../8.6/8.6.md)