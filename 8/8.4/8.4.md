> [8. Aplicaci√≥n de Patrones Arquitecturales](../8.md) ‚Ä∫ [8.4. M√≥dulo 4 / Integrante 4](8.4.md)

# 8.4. Patrones del M√≥dulo Reportes

## **Decisi√≥n 1: Patr√≥n CQRS (Command Query Responsibility Segregation)**

**T√≠tulo:**  
Separaci√≥n de operaciones transaccionales y consultas anal√≠ticas mediante CQRS

**Contexto:**  
El m√≥dulo de Reportes necesita ejecutar consultas anal√≠ticas complejas (ventas por per√≠odo, productos m√°s vendidos, m√°rgenes por proveedor, rotaci√≥n de inventario) sin afectar el rendimiento de las operaciones transaccionales del sistema (registro de ventas, actualizaci√≥n de stock). Ejecutar consultas agregadas sobre el modelo transaccional genera bloqueos, alta latencia y p√©rdida de performance.  
El requisito QAW-02 exige tiempos de respuesta menores a 3 segundos para reportes gerenciales.

**Alternativas:**

1. **Modelo √∫nico para lectura/escritura:**  
   - Simple de implementar  
   - Bloqueos y lentitud ante consultas complejas  
   - No escalable para an√°lisis intensivo  

2. **Replicaci√≥n simple de base de datos:**  
   - Copia adicional para lectura  
   - No separa modelos ni optimiza consultas  
   - No resuelve agregaciones costosas  

3. **Patr√≥n CQRS:**  
   - Lectura y escritura completamente separadas  
   - Modelo de lectura optimizado para reportes  
   - Compatible con vistas materializadas  
   - Permite escalar lectura de forma independiente  
   - Evita afectar operaciones transaccionales

**Criterios de elecci√≥n:**
- Performance en consultas anal√≠ticas  
- Evitar bloqueos en horas de alta carga  
- Escalabilidad independiente entre lectura y escritura  
- Mantenibilidad al separar dominios  

**Decisi√≥n:**  
Se adopta el patr√≥n **CQRS**, separando el modelo transaccional (comandos) del modelo anal√≠tico (consultas).

- **Modelo de comandos:** gestiona ventas, inventario y dem√°s operaciones operativas.  
- **Modelo de consultas:** optimizado para reportes usando vistas materializadas y proyecciones.  
- **Sincronizaci√≥n:** procesos programados actualizan el modelo de lectura sin bloquear el sistema.  
- **Consultas disponibles:** filtros por fecha, categor√≠a, sucursal; agregaciones por per√≠odos; ranking de productos; m√°rgenes.

**Sustento:**  
CQRS permite altos vol√∫menes de consultas sin degradar el rendimiento del sistema operativo. El modelo anal√≠tico se construye espec√≠ficamente para lectura, logrando consultas en menos de 3 segundos incluso con grandes vol√∫menes de informaci√≥n. Este patr√≥n est√° documentado en Microsoft Azure Architecture como adecuado para cargas intensivas de lectura y an√°lisis.

## **Decisi√≥n 2: Patr√≥n Materialized View**

**T√≠tulo:**  
Optimizaci√≥n de reportes frecuentes mediante Materialized View

**Contexto:**  
Reportes como "Top 10 productos vendidos del mes" y "Ventas diarias del a√±o" se consultan m√∫ltiples veces al d√≠a por gerencia. Calcular estas agregaciones en tiempo real desde tablas transaccionales (ventas, detalles_venta) es costoso en performance. QAW-02 requiere reportes en menos de 3 segundos.

**Alternativas:**
1. **Queries en tiempo real:**
   - Calcular agregaciones desde tablas transaccionales
   - Siempre datos actualizados
   - Alto costo computacional
   - No cumple requisito de performance

2. **Patr√≥n Materialized View:**
   - Tablas pre-calculadas con agregaciones
   - Actualizaci√≥n programada (cada hora/d√≠a)
   - Queries ultra r√°pidas
   - Datos ligeramente desactualizados (aceptable)

3. **Cache en memoria:**
   - Redis con agregaciones
   - Mayor complejidad de infraestructura
   - Datos vol√°tiles

**Criterios de elecci√≥n:**
- **Performance:** Tiempo de respuesta < 3 segundos
- **Simplicidad:** M√≠nima complejidad de implementaci√≥n
- **Consistencia eventual:** Tolerancia a datos no instant√°neos
- **Escalabilidad:** Soporte para crecimiento de datos

**Decisi√≥n:**
Patr√≥n Materialized View.

- **Vistas materializadas:** ventas_diarias_mv, productos_mas_vendidos_mv, margen_por_proveedor_mv
- **Actualizaci√≥n:** Job programado cada hora con refresh incremental
- **Consultas:** SELECT directo desde vistas (sin joins complejos)

**Sustento:**  
Materialized Views reducen tiempo de consulta de 15-20 segundos a menos de 1 segundo. ventas_diarias_mv pre-calcula totales diarios, productos_mas_vendidos_mv mantiene ranking actualizado cada hora. Para reportes gerenciales, datos con 1 hora de antig√ºedad son aceptables. PostgreSQL soporta materialized views nativamente con REFRESH CONCURRENTLY (sin bloquear lecturas). Cumple con QAW-02 (performance < 3 seg) sin requerir infraestructura adicional.

<!-- INSERTAR IMAGEN ACERCA DE: Diagrama mostrando tablas transaccionales, job de actualizaci√≥n y materialized views para consultas r√°pidas -->

---

[‚¨ÖÔ∏è Anterior](../8.3/8.3.md) | [üè† Home](../../README.md) | [Siguiente ‚û°Ô∏è](../8.5/8.5.md)
